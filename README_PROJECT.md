# 動画配信サイト - 完全版

自宅用の動画配信サイト/Webアプリケーションです。  
動画ファイルを効率的に管理し、高機能なカスタムプレイヤーで視聴できます。

## 🎯 主な機能

### ファイル管理
- **5つの表示モード**
  - 全ファイル（削除フラグなし）
  - フォルダに存在しないファイル
  - フォルダ別表示（階層構造対応）
  - 削除ファイル一覧
  - 重複ファイル一覧

- **フォルダシステム**
  - ハードリンク/シンボリックリンク的な管理
  - ファイルは物理的に移動せず、タグで管理
  - 階層フォルダ構造対応
  - 複数フォルダへの所属可能

### カスタム動画プレイヤー
- **高度な再生制御**
  - 滑らかなA-Bループ機能
  - 0.1-5倍速の細かい速度調整
  - 長押しで2倍速再生
  - ダブルタップでスキップ/巻き戻し
  - フリックでシーク

- **複数動画の同時再生**
  - PiP風の複数プレイヤー表示
  - 自由配置モード/グリッド配置モード
  - ドラッグ&ドロップで配置変更
  - ピンチでサイズ変更

### UI/UX
- **表示モード切替**
  - サムネイル表示（動くGIF）
  - 詳細表示（テーブル）
  - バーチャライゼーション対応

- **操作性**
  - 右クリック/長押しメニュー
  - 複数選択での一括操作
  - ドラッグ&ドロップ対応
  - キーボードショートカット

## 🛠️ 技術スタック

### バックエンド
- Django 5.0.1
- Django REST Framework
- MySQL 8.0
- Daphne (ASGI)
- FFmpeg（動画処理）

### フロントエンド
- React 18.2
- Material-UI 5.15
- Vite 5.0
- Jotai（状態管理）
- React Virtual（仮想スクロール）

## 📋 必要要件

- Windows 11
- Python 3.10以上
- Node.js 18以上
- MySQL 8.0以上
- FFmpeg
- Redis（オプション）

## 🚀 セットアップ手順

### 1. 事前準備

#### FFmpegのインストール
```bash
# 1. FFmpeg公式サイトからダウンロード
# 2. C:\ffmpeg に解凍
# 3. システム環境変数PATHに C:\ffmpeg\bin を追加
```

#### MySQLのインストール
```bash
# 1. MySQL Installer をダウンロード
# 2. インストール時にrootパスワードを設定
# 3. MySQLサービスが起動していることを確認
```

### 2. プロジェクトのセットアップ

```bash
# プロジェクトをクローン/配置
git clone [repository-url]
cd video_streaming
```

### 3. バックエンドのインストール

```bash
# バックエンドのインストール
install.bat

# 以下の入力が求められます：
# 1. MySQLのrootパスワード
# 2. Django管理者アカウント情報
```

### 4. フロントエンドのインストール

```bash
# フロントエンドのインストール
frontend_install.bat
```

### 5. 動画ファイルの配置

`media/videos/` フォルダに動画ファイルを配置してください。

対応フォーマット：
- mp4, avi, mkv, mov, wmv, flv, webm, m4v, mpg, mpeg

### 6. システムの起動

```bash
# バックエンドとフロントエンドを同時起動
start_all.bat
```

または個別に起動：

```bash
# バックエンド起動
runserver.bat

# フロントエンド起動（別ウィンドウで）
cd frontend
npm run dev
```

## 📍 アクセスURL

- **フロントエンド**: http://localhost:3000
- **バックエンドAPI**: http://localhost:8000/api
- **Django管理画面**: http://localhost:8000/admin

## 📁 ディレクトリ構造

```
video_streaming/
├── install.bat              # バックエンドインストール
├── runserver.bat            # バックエンド起動
├── frontend_install.bat     # フロントエンドインストール
├── start_all.bat           # 統合起動
├── requirements.txt        # Python依存関係
├── backend/               # Djangoバックエンド
│   ├── manage.py
│   ├── backend/           # プロジェクト設定
│   └── videos/           # 動画管理アプリ
├── frontend/             # Reactフロントエンド
│   ├── package.json
│   ├── vite.config.js
│   └── src/
│       ├── components/   # UIコンポーネント
│       ├── pages/       # ページコンポーネント
│       ├── services/    # APIサービス
│       ├── store/       # 状態管理
│       └── utils/       # ユーティリティ
├── media/               # メディアファイル
│   ├── videos/         # 動画ファイル
│   └── gifs/          # サムネイルGIF
└── logs/              # ログファイル
```

## ⚙️ 自動処理

### バックグラウンドタスク
1. **起動時スキャン**: サーバー起動時に自動実行
2. **定期スキャン**: 6時間ごとに自動実行
3. **重複検出**: MD5ハッシュで自動検出
4. **GIF生成**: 動画の最初10秒から自動生成

## 🎮 使い方

### 基本操作
1. **ファイル表示切替**: ヘッダーのトグルボタン
2. **複数選択**: 複数選択ボタンをON
3. **右クリックメニュー**: ファイルを右クリック/長押し
4. **動画再生**: サムネイルをクリック

### プレイヤー操作
- **スペース**: 再生/一時停止
- **ダブルタップ左**: 5秒巻き戻し
- **ダブルタップ右**: 5秒スキップ
- **長押し**: 2倍速再生
- **F**: フルスクリーン
- **L**: ループ切替
- **M**: ミュート切替

### 複数動画再生
1. 動画プレイヤーの「+」ボタンをクリック
2. 追加する動画を選択
3. 「選択動画をすべて開く」をクリック
4. ドラッグで配置変更、ピンチでサイズ変更

## 🔧 トラブルシューティング

### よくある問題

#### MySQLエラー
```
Error: Can't connect to MySQL server
```
→ MySQLサービスが起動しているか確認

#### FFmpegエラー
```
Error: ffmpeg not found
```
→ FFmpegがPATHに追加されているか確認

#### ポート使用中
```
Error: Port 8000/3000 is already in use
```
→ 他のアプリケーションがポートを使用していないか確認

#### 動画が再生されない
- 動画ファイルのパスを確認
- FFmpegが正しくインストールされているか確認
- ブラウザのコンソールでエラーを確認

## 🔒 セキュリティ注意事項

- このシステムは**自宅内での使用**を想定しています
- 外部公開する場合は以下の対策が必要：
  - Django SECRET_KEYの変更
  - DEBUG=Falseに設定
  - 適切な認証機能の追加
  - HTTPSの設定
  - ファイアウォール設定

## 📝 カスタマイズ

### 設定ファイル

#### バックエンド設定
`backend/backend/settings.py`:
- データベース設定
- メディアファイルパス
- スキャン間隔

#### フロントエンド設定
`frontend/.env`:
- APIエンドポイント
- メディアURL

### プレイヤー設定
`frontend/src/store/atoms.js`:
- デフォルト再生速度
- スキップ秒数
- その他プレイヤー設定

## 🚧 今後の機能追加予定

- [ ] 字幕対応
- [ ] プレイリスト機能
- [ ] 視聴履歴
- [ ] お気に入り機能
- [ ] 動画エンコード機能
- [ ] モバイルアプリ版

## 📄 ライセンス

個人使用のみ。商用利用不可。

## 🤝 貢献

プルリクエストは歓迎します。  
大きな変更の場合は、まずissueを開いて変更内容を議論してください。

## 📧 サポート

問題が発生した場合は、以下を確認してください：
1. このREADMEのトラブルシューティング
2. ログファイル（`logs/django.log`）
3. ブラウザのコンソール

---

© 2024 Video Streaming System - Personal Use Only